---
title: "Cloudflare Pages(Functions,KV)ã‚’ä½¿ã£ãŸã‚µã‚¤ãƒˆã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹éš›ã«è¡Œã£ãŸã“ã¨"
emoji: "ğŸŒ¥ï¸"
type: "tech"
topics: ["cloudflare", "cloudflareworkers", "cloudflarepages", "cloudflarefuntions"]
published: true
---

## ã¯ã˜ã‚ã«

:::message
2022å¹´2æœˆ8æ—¥ç¾åœ¨Cloudflare Functionsã¯betaç‰ˆã¨ãªã‚Šã¾ã™ã€‚åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚[Functionsã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/pages/platform/functions)ã«ã¦ã€çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚
:::

æœ¬è¨˜äº‹ã§ã¯`Cloudflare Pages`ã‚’èµ·ç‚¹ã«ã€Cloudflareã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’è‰²ã€…è©¦ã™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

* `Cloudflare Pages`ã§ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ãŸã„
* `Cloudflare Functions(beta)`ã‚’ä½¿ã£ã¦ã¿ãŸã„
* `Cloudflare Worker KV`ã‚’ä½¿ã£ã¦ã¿ãŸã„
* `Cloudflare Pages`ã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ãŸã‚µã‚¤ãƒˆã«IPãƒ•ã‚£ãƒ«ã‚¿è¨­å®šã‚’å…¥ã‚ŒãŸã„

## æ§‹æˆ
ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ã«ã€ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é©ç”¨ã—ãŸCloudflareä¸Šã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚µã‚¤ãƒˆã‹ã‚‰Cloudflare Functionsã‚’çµŒç”±ã—ã¦Cloudflare KVã‚’èª­ã¿æ›¸ãã™ã‚‹æ§‹æˆã¨ãªã‚Šã¾ã™ã€‚(ä»¥é™Cloudflare Functionsã‚’Functions, Cloudflare KVã‚’KVã¨çœç•¥ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚)

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644313148/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/dpqu7xe3mg2krwd8qw14.png)


## ç’°å¢ƒæƒ…å ±
* Google Domainã§ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—æ¸ˆ(é©å®œèª­ã¿æ›¿ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€ã©ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒ©ã‚’ä½¿ã£ã¦ã‚‚å•é¡Œãªã„ã§ã™)
* Cloudflare Pagesã«ã¯ã€Zone Apexãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®š

|ãƒ„ãƒ¼ãƒ«|ãƒãƒ¼ã‚¸ãƒ§ãƒ³|
|---|---|
|node|v16.10.0|

## Cloudflare WebSitesã®è¨­å®š
Cloudflare WebSitesã®è¨­å®šã‚’ã—ã¾ã™ã€‚æœ¬è¨­å®šã¯ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é©ç”¨ã™ã‚‹å‰æº–å‚™ã¨ãªã‚Šã¾ã™ã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644238986/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/erseikb3omukwk5riw8d.png)

å–å¾—ã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›ã—ã¾ã™
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239169/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/n1mya5mhwocqtgildoom.png)

ãƒ—ãƒ©ãƒ³ã¯freeã‚’é¸æŠã—ã¾ã™
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239252/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/i0yxwngtscahmywexyg6.png)

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239452/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/mwc1ssvnbhwk6pnr7hoj.png)


Cloudflareå´ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€è¿½åŠ ã®è¨­å®šæ–¹æ³•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä»Šå›ã¯Google Domainå´ã§Name Serverã‚’å¤‰æ›´ã™ã‚‹æ—¨ã®èª¬æ˜ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚Name Serverã‚’æ§ãˆã¦ãŠãã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239537/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/ipn8zt6nomhlrjlsjwv4.png)

Google Domainsã®è¨­å®šã«è¡Œãã¾ã™ã€‚å…ˆã»ã©Cloudflareã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚³ãƒ”ãƒšã—ãŸName Serverã‚’è¨­å®šã—ã¾ã™
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239676/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/sfryfydldoozzbjqy8kr.png)

å†ã³Cloudflareã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã€WebSitesã‚’é–‹ãã¨çŠ¶æ…‹ãŒActiveã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644239828/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/hp1fxmbnaho8tr7kph7v.png)


## Cloudflare Pagesãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆæœŸåŒ–

[`vite`](https://github.com/vitejs/vite) ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™

```bash
$ npm init vite@latest
âœ” Project name: â€¦ cf-sample-site
âœ” Select a framework: â€º react
âœ” Select a variant: â€º react-ts

Scaffolding project in /Users/hoge/repos/github.com/shuntaka9576/cf-sample-site...

Done. Now run:

  cd cf-sample-site
  npm install
  npm run dev
$ cd cf-sample-site
$ yarn install
$ yarn dev
```


### å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥
Cloudflareå…¬å¼CLIã§ã‚ã‚‹[cloudflare/wrangler2](https://github.com/cloudflare/wrangler2)ã‚’å°å…¥ã—ã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯åˆ©ç”¨ã—ã¾ã›ã‚“ãŒã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚»ãƒƒãƒˆã§å…¥ã‚Œã¦ãŠãã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚(wrangler initã§å°å…¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™)

```bash
$ yarn add -O wrangler@beta
$ yarn add -D @cloudflare/workers-types
$ yarn wrangler --version
(ä¸­ç•¥)
0.0.16
```

### Cloudflare KVã®ä½œæˆã¨è¨­å®š

wranglerã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆæœŸåŒ–ã—ã¾ã™
```bash
$ yarn wrangler init
(ä¸­ç•¥)
Would you like to install wrangler into your package.json? (y/n)
# => æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã®ãŸã‚nã‚’å…¥åŠ›
Would you like to create a Worker at src/index.ts? (y/n)
# => åˆ©ç”¨ã—ãªã„ãŸã‚nã‚’å…¥åŠ›
```

å‡ºåŠ›ã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™
```toml:wrangler.toml
compatibility_date = "2022-02-07"
```

Cloudflare KVã‚’CLIçµŒç”±ã§ä½œæˆã—ã¾ã™

```bash
$ yarn wrangler kv:namespace create "MY_KV_DEV"
```

å®Ÿè¡Œã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ãŒèµ·å‹•ã—ã€ãƒ­ã‚°ã‚¤ãƒ³å¾Œä»¥ä¸‹ã®ã‚ˆã†ãªèªå¯ç”»é¢ã«é·ç§»ã—ã¾ã™ã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644270593/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/t7sjofyyrr0lvsp5bwkm.png)

è¨­å®šå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644270609/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/gku513kncx7saco8lxnt.png)

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã€KVä½œæˆå‡¦ç†ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
$ yarn wrangler kv:namespace create "MY_KV_DEV"
yarn run v1.22.17
warning package.json: No license field
(ä¸­ç•¥)
Successfully configured. You can find your configuration file at: /Users/hoge/.wrangler/config/default.toml
ğŸŒ€ Creating namespace with title "worker-MY_KV_DEV"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "MY_KV_DEV", id = "xxxxx" }
âœ¨  Done in 12.52s.
```

ä½œæˆå¾Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã«ä½œæˆã—ãŸKVãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644270643/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/cfnhy9fk0f7rmxworj5x.png)

CLIã§ã‚‚ç¢ºèªå¯èƒ½ã§ã™

```bash
$ yarn wrangler kv:namespace list
[
  {
    "id": "xxxxx",
    "title": "worker-MY_KV_DEV",
    "supports_url_encoding": true
  }
]
```

CLIã®å‡ºåŠ›é€šã‚Šwrangler.tomlã«ä½œæˆã—ãŸCloudflare KVã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™
[ts gutter="false" title="wrangler.toml"]
```toml:wrangler.toml
compatibility_date = "2022-02-07"

kv_namespaces = [
  { binding = "MY_KV_DEV", id = "xxxxx" }
]
```


### Cloudflare Functionsã¨å‹•ä½œç¢ºèªç”¨UIã®å®Ÿè£…
ç¢ºèªç”¨ã®UIã¨Cloudflare Functionsã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ç¢ºèªç”¨UIã‚’å®Ÿè£…ã—ã¾ã™ã€‚(ã™ã„ã¾ã›ã‚“ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«å¼±ãã€ã‚³ãƒ¼ãƒ‰ã®ä¸å‚™ãŒã‚ã‚Šã¾ã—ãŸã‚‰issueãŠé¡˜ã„ã—ã¾ã™ã€‚ã€‚)

```ts:src/App.tsx
import { useEffect, useState } from "react";

type WriteItem = {
  key: string;
  value: string;
};

const App = () => {
  const [schedulePostData, setSchedulePostData] = useState<WriteItem>();
  const [data, setGetData] = useState('');

  useEffect(() => {
    const timestamp = Date.now();
    const key = `key:${timestamp}`;
    const value = `value:${timestamp}`;

    setSchedulePostData({ key: key, value: value });
  }, [])

  const updateTime = () => {
    const timestamp = Date.now();
    const key = `key:${timestamp}`;
    const value = `value:${timestamp}`;

    setSchedulePostData({ key: key, value: value });

  }

  const post = async () => {
    await fetch("/api/data", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ key: schedulePostData?.key, value: schedulePostData?.value })
    });
  };

  const get = async () => {
    const data = await fetch(`/api/data/${schedulePostData?.key}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json"
      },
    });

    const parsedJson = await data.json();
    setGetData(parsedJson.value)
  };


  return (
    <div className="App">
      <p>æ›¸ãè¾¼ã‚€äºˆå®šã®ãƒ‡ãƒ¼ã‚¿<button onClick={() => updateTime()}>æ›´æ–°</button></p>
      <ul>
      <li>ã‚­ãƒ¼: {schedulePostData?.key}</li>
      <li>ãƒãƒªãƒ¥ãƒ¼: {schedulePostData?.value}</li>
      </ul>
      <button onClick={() => post()}>Cloudflare KVã«æ›¸ãè¾¼ã‚€</button>
      <hr/>

      <p>ã‚­ãƒ¼{schedulePostData?.key}ã®å€¤ã‚’å–å¾—ã™ã‚‹</p>
      <button onClick={() => get()}>å–å¾—</button>
      <p>å–å¾—çµæœ:{data}</p>
    </div>
  );
};

export default App;
```



Functionsã®å®Ÿè£…ã¯ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/pages/platform/functions#setup)ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®Functionsã‚’å®Ÿè£…ã—ã¾ã™ã€‚ä»¥ä¸‹ã«æŒ™å‹•ã®ç•¥å›³ã‚’ç¤ºã—ã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644308464/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/x7q0mrkeflaejgpmp8pa.png)

```ts:functions/api/data/index.ts
export const onRequestPost = async ({ request, env }) => {
  const body = await request.clone().text();
  const parsedBody = JSON.parse(body);
  const { key, value } = parsedBody;

  await env.MY_KV_DEV.put(key, value); // Cloudflare KVã¸æ›¸ãè¾¼ã¿

  return new Response();
};
```


å‰è¿°ã®Functionsã§æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹GETç”¨ã®Functionsã‚’å®Ÿè£…ã—ã¾ã™ã€‚idã«ã¯ã€å‰è¿°POSTæ™‚ã«å…¥ã‚ŒãŸkeyãŒå…¥ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã«æŒ™å‹•ã®ç•¥å›³ã‚’ç¤ºã—ã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644308523/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/ctaopbk0fjpa2tfzp0fm.png)

```ts:functions/api/data/[id].ts
export const onRequestGet = async ({ params, env }) => {
  const res = await env.MY_KV_DEV.get(params.id); // Cloudflare KVã¸èª­ã¿è¾¼ã¿

  return new Response(JSON.stringify({ value: res }));
};
```


### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¯ã€viteã§ã¯ãªãwranglerã‚’åˆ©ç”¨ã—ã¾ã™ã€‚Cloudflare KVã¨Cloudflare Functionsã‚’å®Ÿéš›ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèªãŒå¯èƒ½ãªãŸã‚ã§ã™ã€‚ãƒ“ãƒ«ãƒ‰ã¯å¿…è¦ãªã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ã‚’æ¤œçŸ¥ã—ãŸã‚‰ãƒ“ãƒ«ãƒ‰ãŒèµ°ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```bash
$ yarn build --watch
```

wranglerã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`http://localhost:8788/`ã§è‡ªå‹•çš„ã«ã‚¿ãƒ–ãŒé–‹ãã¾ã™ã€‚

|ã‚ªãƒ—ã‚·ãƒ§ãƒ³|èª¬æ˜|
|---|---|
|pages dev|Cloudflare Pagesã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
|-k|Cloudflare KVã®æŒ‡å®š(å‰é …ã§ä½œæˆã—ãŸKVã§ã¯ãªãã€ãƒ­ãƒ¼ã‚«ãƒ«ã§æ“¬ä¼¼KVãŒå®Ÿè¡Œã•ã‚Œã¾ã™)
|--live-reload|ãƒ“ãƒ«ãƒ‰è³‡æã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ãŸã‚‰ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹
|./dist|ãƒ“ãƒ«ãƒ‰è³‡æã®æŒ‡å®š

```bash
$ yarn wrangler pages dev -k MY_KV_DEV --live-reload ./dist

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ãŸã„å ´åˆ
$ yarn wrangler pages dev -k MY_KV_DEV --binding ENV_VALUE="3" --live-reload ./dist
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚Cloudflare KVã¸key,valueã‚’æ›¸ãè¾¼ã¿ã€æ›¸ãè¾¼ã‚“ã å€¤ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644307660/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/kjtrgradq5yjgzgrbhkh.gif)


## Cloudflare Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤

åˆã‚ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹å ´åˆã€GitHub Appsã®èªå¯ãŒå¿…è¦ã§ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644309595/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/w6vrkvsuc7dekgcjc23v.png)

ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã¾ã™
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644309597/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/dnnxvsa2uyeyynxvcrlg.png)

ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã€è³‡æã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæŒ‡å®šã‚’è¡Œã„ã¾ã™
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644309599/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/ebjddlbcx6bzzbnayfza.png)

ã‚µã‚¤ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸ(ã“ã‚Œã§ã¯ã¾ã å‹•ãã¾ã›ã‚“)
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644310040/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/iv3zfawun9rwvwkvclvc.png)

Functionsã¨KVã®é€£æºè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644360460/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/jeqrcvylxrirtvggzzaa.png)


ä¸Šè¨˜ã‚’å®Ÿæ–½å¾Œã€**å†åº¦Cloudflare Pagesã®ç”»é¢ã§ã€`View Build`-&gt; `Manage deployment` -&gt; `Retry development`ã§å†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„** (â€» ã‚‚ã—ã‹ã—ãŸã‚‰å¿…è¦ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“)

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644310877/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/feguax2vrb5al5l0iqbr.png)

æœ¬è¨­å®šã‚ˆã‚Šã€å‰é …ã§ä½œæˆã—ãŸå®Ÿéš›ã®Cloudflare KVã«å¯¾ã—ã¦Read/Writeã—ã¾ã™ã€‚æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰ã‚‚ç¢ºèªã§ãã¾ã™ã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644360315/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/r7bapaucs4huljkdwwri.png)

## ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®é©ç”¨
ä»Šå›ã¯`xxx.dev`ã®ã‚ˆã†ãªApexãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å‰²ã‚Šå½“ã¦ã¾ã™

Pagesã®è¨­å®šç”»é¢ã‚’é–‹ãã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644360754/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/dsxu6w3m7ful9rwtinwr.png)

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644311260/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/n1iydgkarlqljibcfgno.png)
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644311262/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/qktb1ebpe6ozghcqdnzn.png)
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644311267/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/n4daehtsescpf4j4madq.png)

ã—ã°ã‚‰ãå¾…ã¤ã¨ã€Activeã«ãªã‚Šã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644311445/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/u8xkfcgg404jd1hbslcv.png)

ç„¡äº‹ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644311540/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/soxsc6gaalflus1jslms.png)

## Firewall Ruleã®é©ç”¨
é–‹ç™ºç’°å¢ƒã ã¨ã€IPãƒ•ã‚£ãƒ«ã‚¿ã‚’ã—ãŸã„å ´åˆãŒã‚ã‚‹ã®ã§è¨­å®šã—ã¾ã™ã€‚

![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644312092/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/teipu7sgfa4mm14gsgpt.png)
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644312067/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/loqk8hukuwbyuw4wv5j2.png)


ä»¥ä¸‹ã®ç”»åƒã§ã¯æŒ‡å®šã—ãŸIPv4, IPv6(ç¯„å›²)ã‚¢ãƒ‰ãƒ¬ã‚¹ä»¥å¤–ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹è¨­å®šã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚(Rule NameãŒipv4ã«ãªã£ã¦ã„ã¾ã™ãŒã€å…¥åŠ›ãƒŸã‚¹ã§ã™)ã€‚è¤‡æ•°IPä»¥å¤–ã¯ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚ˆã†ãªæ¡ä»¶ã¯ã€`is not in`å¥ã‚’åˆ©ç”¨ã—ã€1ã¤å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã«è¤‡æ•°ã®IPã‚’å…¥ã‚Œã‚‹ã“ã¨ã§å®Ÿç¾å¯èƒ½ã§ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644312281/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/o6nxma91qnkcekp9aga3.png)

ãƒ–ãƒ­ãƒƒã‚¯ã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚
![img](https://res.cloudinary.com/dkerzyk09/image/upload/v1644312984/blog/2022-02-05-shuntaka-cloudflare-pages-and-other-functions/cwk6hatm2ue0rrasbqiq.png)


## ã•ã„ã”ã«
æœ¬ç¨¿ã§ã¯ã€Cloudflare Pagesã‚’èµ·ç‚¹ã«ã—ã€KVã‚„Functionsã‚’è©¦ã—ã¾ã—ãŸã€‚CDN Edgeã®æŠ€è¡“ãŒå¹´ã€…é€²åŒ–ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ä»Šã¾ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã‚„ã£ã¦ã„ãŸã“ã¨ã‚’CDN Edgeä¸Šã§ã‚„ã£ãŸæ–¹ãŒåŠ¹ç‡ãŒè‰¯ã„ã‚±ãƒ¼ã‚¹ã¨ã„ã†ã®ãŒå¢—ãˆã¦ã„ãã¨æ€ã£ã¦ã„ã¾ã™ã€‚ä»Šå¾Œã®æŠ€è¡“é¸å®šã®ä¸€ã¤ã®é¸æŠè‚¢ã¨ã—ã¦å‚è€ƒã«ãªã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

## å‚è€ƒ
* [Cloudflare Pages + Functions + Workers KV + vite + preactã§ç°¡å˜ãªãƒšãƒ¼ã‚¸ã‚’ä½œã£ãŸ](https://zenn.dev/razokulover/articles/bd1fe4e21ebd91)
* [https://github.com/cloudflare/wrangler2/issues/194](https://github.com/cloudflare/wrangler2/issues/194)
* [Functions (beta)](https://developers.cloudflare.com/pages/platform/functions)
